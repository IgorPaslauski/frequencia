<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Estatística Rápida – Medidas & Histogramas</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
      :root {
        --bg: #0b1020;
        --card: #121833;
        --muted: #8aa0ff;
        --text: #e7ecff;
        --accent: #7aa2ff;
        --ok: #6ee7b7;
        --warn: #fbbf24;
        --danger: #f87171;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: linear-gradient(180deg, #0b1020, #0b132b 40%, #0d142f);
        color: var(--text);
      }
      .container {
        max-width: 1100px;
        margin: 32px auto;
        padding: 0 16px;
      }
      header {
        display: flex;
        gap: 14px;
        align-items: center;
        margin-bottom: 18px;
      }
      header h1 {
        font-size: clamp(20px, 2.3vw, 28px);
        margin: 0;
        letter-spacing: 0.2px;
      }
      header .badge {
        font-size: 12px;
        padding: 4px 8px;
        border: 1px solid #2b376b;
        border-radius: 999px;
        color: #c9d3ff;
      }
      .card {
        background: linear-gradient(180deg, #111737 0%, #101632 100%);
        border: 1px solid rgba(122, 162, 255, 0.12);
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      }
      .grid {
        display: grid;
        gap: 16px;
      }
      .grid.cols {
        grid-template-columns: 1.2fr 1fr;
      }
      @media (max-width: 920px) {
        .grid.cols {
          grid-template-columns: 1fr;
        }
      }
      .section {
        padding: 16px;
        border-top: 1px solid rgba(122, 162, 255, 0.08);
      }
      .section:first-child {
        border-top: 0;
        border-top-left-radius: 16px;
        border-top-right-radius: 16px;
      }
      .section h2 {
        font-size: 16px;
        margin: 0 0 8px 0;
        color: #cfe1ff;
      }
      textarea {
        width: 100%;
        min-height: 140px;
        resize: vertical;
        background: #0e1430;
        color: #e9edff;
        border: 1px solid #263060;
        border-radius: 12px;
        padding: 12px;
        outline: none;
        box-shadow: inset 0 0 0 1px transparent;
        transition: box-shadow 0.2s, border-color 0.2s;
      }
      textarea:focus {
        border-color: #3852a8;
        box-shadow: 0 0 0 3px rgba(122, 162, 255, 0.25);
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: end;
      }
      label {
        font-size: 12px;
        color: #b9c6ff;
        display: block;
        margin-bottom: 4px;
      }
      input[type="number"],
      select {
        background: #0e1430;
        color: #e9edff;
        border: 1px solid #263060;
        border-radius: 10px;
        padding: 10px 12px;
        outline: none;
        width: 100%;
        min-width: 120px;
      }
      button {
        background: linear-gradient(135deg, #6a8cff, #7aa2ff);
        color: white;
        border: none;
        padding: 10px 14px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 6px 18px rgba(122, 162, 255, 0.35);
        transition: transform 0.06s ease;
      }
      button:active {
        transform: translateY(1px);
      }
      .btn-ghost {
        background: transparent;
        border: 1px solid rgba(122, 162, 255, 0.35);
        color: #cfe1ff;
        box-shadow: none;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      th,
      td {
        text-align: left;
        padding: 10px 8px;
        border-bottom: 1px dashed rgba(122, 162, 255, 0.15);
      }
      th {
        color: #cfe1ff;
        font-weight: 600;
      }
      .muted {
        color: #97a7ff;
        opacity: 0.9;
      }
      .pill {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid #31407a;
        color: #d6e2ff;
        font-size: 12px;
      }
      .stat {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .stat b {
        font-size: 15px;
      }
      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
      }
      .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      }
      .foot {
        color: #97a7ff;
        font-size: 12px;
        opacity: 0.85;
      }
      .warn {
        color: var(--warn);
      }
      .sorted-chip {
        display: inline-block;
        padding: 1px 6px;
        border-radius: 6px;
        margin: 1px 0;
      }
      .sorted-chip.mode {
        background: rgba(251, 191, 36, 0.25);
        color: #ffd36a;
        border: 1px solid rgba(251, 191, 36, 0.35);
      }
      .meta {
        font-size: 12px;
        color: #cfe1ff;
        opacity: 0.9;
        margin-top: 6px;
      }
      .tr-modal {
        background: rgba(251, 191, 36, 0.1);
      }
      .badge-modal {
        display: inline-block;
        margin-left: 6px;
        font-size: 11px;
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid rgba(251, 191, 36, 0.45);
        color: #ffd36a;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Estatística Rápida <span class="muted">— média, mediana, moda, variância, desvio, CV e histograma</span></h1>
        <span class="badge">100% local / sem upload</span>
      </header>

      <div class="card">
        <div class="section grid cols">
          <div>
            <h2>1) Cole seus dados (números separados por vírgula)</h2>
            <textarea id="inputData" placeholder="Ex.: 18,20,19,22,21,20,20,19,18,22"></textarea>
            <div class="row" style="margin-top: 10px">
              <div>
                <label for="decimal">Separador decimal (se usar vírgula em decimais)</label>
                <select id="decimal">
                  <option value="auto" selected>Auto</option>
                  <option value="dot">Ponto (.)</option>
                  <option value="comma">Vírgula (,)</option>
                </select>
              </div>
              <div>
                <label for="bins">Nº de classes (bins do histograma)</label>
                <input type="number" id="bins" min="1" step="1" placeholder="auto (Sturges)" />
              </div>
              <div>
                <label>&nbsp;</label>
                <button id="btnCalc">Calcular</button>
              </div>
              <div>
                <label>&nbsp;</label>
                <button id="btnExample" class="btn-ghost">Usar exemplo</button>
              </div>
            </div>
            <p class="foot">Dica: aceita vírgula, ponto e vírgula, espaço e nova linha. Decimais com vírgula também são convertidos.</p>
          </div>
          <div>
            <h2>2) Resumo rápido</h2>
            <div class="row">
              <div class="stat"><span class="pill">n</span> <b id="s_n">—</b></div>
              <div class="stat"><span class="pill">mín</span> <b id="s_min">—</b></div>
              <div class="stat"><span class="pill">máx</span> <b id="s_max">—</b></div>
              <div class="stat"><span class="pill">amplitude</span> <b id="s_range">—</b></div>
            </div>
            <div class="row" style="margin-top: 8px">
              <div class="stat"><span class="pill">média</span> <b id="s_mean">—</b></div>
              <div class="stat"><span class="pill">mediana</span> <b id="s_median">—</b></div>
              <div class="stat"><span class="pill">moda</span> <b id="s_mode">—</b></div>
            </div>
            <div class="row" style="margin-top: 8px">
              <div class="stat"><span class="pill">variância (pop)</span> <b id="s_varp">—</b></div>
              <div class="stat"><span class="pill">desvio (pop)</span> <b id="s_stdp">—</b></div>
            </div>
            <div class="row" style="margin-top: 8px">
              <div class="stat"><span class="pill">variância (amostral)</span> <b id="s_vars">—</b></div>
              <div class="stat"><span class="pill">desvio (amostral)</span> <b id="s_stds">—</b></div>
              <div class="stat"><span class="pill">CV%</span> <b id="s_cv">—</b></div>
            </div>
            <div class="meta" id="binMeta"></div>
          </div>
        </div>

        <div class="section">
          <h2>3) Tabela de frequências (histograma)</h2>
          <div class="row" style="justify-content: space-between; margin-bottom: 8px">
            <div class="foot">Classes automáticas (Sturges + passo “bonito”). Você pode ajustar o nº de classes nas opções.</div>
            <div class="row">
              <button id="btnDownloadCsv" class="btn-ghost">Baixar CSV</button>
            </div>
          </div>
          <div style="overflow: auto">
            <table id="freqTable"></table>
          </div>
        </div>

        <div class="section">
          <h2>4) Histograma</h2>
          <canvas id="histCanvas" height="120"></canvas>
        </div>

        <div class="section">
          <h2>5) Dados ordenados</h2>
          <div id="sortedBox" class="mono foot"></div>
          <div class="foot" id="sortedLegend"></div>
        </div>
      </div>

      <p class="foot" style="margin-top: 12px">Feito com <span aria-hidden>❤</span> em JavaScript. Cálculos locais, sem enviar dados.</p>
    </div>

    <script>
      // ————— Utils —————
      function parseNumbers(str, decimalMode = "auto") {
        if (!str) return [];
        let s = String(str).trim();
        s = s.replace(/[\n\t;\s]+/g, ",");
        s = s.replace(/,+/g, ",").replace(/^,|,$/g, "");
        const items = s
          .split(",")
          .map(x => x.trim())
          .filter(Boolean);
        return items
          .map(x => {
            let v = x;
            if (decimalMode === "comma" || (decimalMode === "auto" && /\d,\d/.test(v) && !/\d\.\d/.test(v))) {
              v = v.replace(/\./g, "");
              v = v.replace(",", ".");
            }
            return Number(v);
          })
          .filter(v => Number.isFinite(v));
      }

      const mean = arr => arr.reduce((a, b) => a + b, 0) / arr.length;
      function median(arr) {
        const a = [...arr].sort((x, y) => x - y);
        const n = a.length;
        if (n === 0) return NaN;
        return n % 2 === 1 ? a[(n - 1) / 2] : (a[n / 2 - 1] + a[n / 2]) / 2;
      }
      function modes(arr) {
        const freq = new Map();
        for (const x of arr) freq.set(x, (freq.get(x) || 0) + 1);
        const max = Math.max(...freq.values());
        if (max <= 1) return [];
        return [...freq.entries()]
          .filter(([, v]) => v === max)
          .map(([k]) => k)
          .sort((a, b) => a - b);
      }
      function variance(arr, sample = false) {
        const m = mean(arr),
          n = arr.length;
        const ss = arr.reduce((acc, x) => acc + (x - m) * (x - m), 0);
        return sample && n > 1 ? ss / (n - 1) : ss / n;
      }
      const sturges = n => Math.max(1, Math.ceil(Math.log2(n)) + 1);
      const nice = x => (Number.isFinite(x) ? (+x.toFixed(6)).toString() : "—");

      // número "bonito" de passo (1, 2, 2.5, 5 × 10^p)
      function niceStep(raw) {
        if (!isFinite(raw) || raw <= 0) return 1;
        const exp = Math.floor(Math.log10(raw));
        const f = raw / Math.pow(10, exp);
        const base = f <= 1 ? 1 : f <= 2 ? 2 : f <= 2.5 ? 2.5 : f <= 5 ? 5 : 10;
        return base * Math.pow(10, exp);
      }

      function isDiscreteData(data) {
        const allInt = data.every(x => Number.isInteger(x));
        const uniq = new Set(data).size;
        return allInt && (uniq <= 20 || uniq <= data.length / 2);
      }

      // Constrói bins automaticamente:
      // - Discreto: uma classe por valor (rótulo = valor)
      // - Contínuo: Sturges -> passo "bonito", alinhado ao piso deste passo
      function buildHistogramAuto(data, kInput) {
        const n = data.length;
        const min = Math.min(...data),
          max = Math.max(...data);
        const range = max - min || 1;

        // DISCRETO
        if (isDiscreteData(data) && !kInput) {
          const freq = new Map();
          for (const x of data) freq.set(x, (freq.get(x) || 0) + 1);
          const values = [...freq.keys()].sort((a, b) => a - b);
          const bins = values.map(v => ({
            from: v - 0.5,
            to: v + 0.5,
            freq: freq.get(v),
            label: String(v),
          }));
          return { bins, k: bins.length, h: 1, start: values[0] - 0.5, discrete: true };
        }

        // CONTÍNUO
        const k = Math.max(1, +(kInput || 0)) || sturges(n);
        const rawWidth = range / k;
        const h = niceStep(rawWidth);
        const start = Math.floor(min / h) * h;
        const end = Math.ceil(max / h) * h;
        const kReal = Math.max(1, Math.round((end - start) / h));
        const bins = Array.from({ length: kReal }, (_, i) => ({
          from: start + i * h,
          to: start + (i + 1) * h,
          freq: 0,
        }));
        for (const x of data) {
          let idx = Math.floor((x - start) / h);
          if (idx < 0) idx = 0;
          if (idx >= bins.length) idx = bins.length - 1;
          bins[idx].freq++;
        }
        return { bins, k: bins.length, h, start, discrete: false };
      }

      // ————— UI —————
      const el = id => document.getElementById(id);
      const input = el("inputData");
      const decimalSel = el("decimal");
      const binsInput = el("bins");
      let chart;

      function render(data) {
        if (!data.length) {
          alert("Forneça ao menos um número.");
          return;
        }

        const n = data.length;
        const min = Math.min(...data),
          max = Math.max(...data);
        const range = max - min;
        const m = mean(data);
        const med = median(data);
        const md = modes(data);
        const varp = variance(data, false);
        const stdp = Math.sqrt(varp);
        const vars = variance(data, true);
        const stds = Math.sqrt(vars);
        const cv = (stds / m) * 100;

        // resumo
        el("s_n").textContent = n;
        el("s_min").textContent = nice(min);
        el("s_max").textContent = nice(max);
        el("s_range").textContent = nice(range);
        el("s_mean").textContent = nice(m);
        el("s_median").textContent = nice(med);
        el("s_mode").textContent = md.length ? md.join(", ") : "—";
        el("s_varp").textContent = nice(varp);
        el("s_stdp").textContent = nice(stdp);
        el("s_vars").textContent = n > 1 ? nice(vars) : "—";
        el("s_stds").textContent = n > 1 ? nice(stds) : "—";
        el("s_cv").textContent = n > 1 && isFinite(cv) ? nice(cv) : "—";

        // histograma (auto)
        const kUser = binsInput.value ? +binsInput.value : undefined;
        const { bins, k, h, start, discrete } = buildHistogramAuto(data, kUser);
        renderFreqTable(bins);
        renderChart(bins);
        el("binMeta").textContent = `k = ${k}  |  h = ${nice(h)}  |  início = ${nice(start)}  ${discrete ? "• modo discreto" : ""}`;

        // dados ordenados com moda em destaque
        const sorted = [...data].sort((a, b) => a - b);
        const modeSet = new Set(md);
        el("sortedBox").innerHTML = sorted
          .map(v => {
            const isMode = modeSet.has(v);
            return `<span class="sorted-chip ${isMode ? "mode" : ""}">${nice(v)}</span>`;
          })
          .join(" ");
        el("sortedLegend").innerHTML = md.length
          ? `<span class="sorted-chip mode"> </span> <span class="foot">= moda (${md.join(", ")})</span>`
          : `<span class="foot">Sem moda (todas as frequências iguais)</span>`;

        // CSV
        el("btnDownloadCsv").onclick = () => downloadCsvSummary(sorted, bins, { n, min, max, range, m, med, md, varp, stdp, vars, stds, cv });
      }

      function intervalLabel(b) {
        // Se veio com label (discreto), usa-o; senão formata [a - b)
        if (b.label) return String(b.label);
        return `[${nice(b.from)} - ${nice(b.to)})`;
      }

      function renderFreqTable(bins) {
        const tbl = el("freqTable");
        const rows = [];
        rows.push(`<tr><th>Classe</th><th>Intervalo</th><th>Frequência</th><th>Frequência relativa</th><th>Frequência acumulada</th><th>Frequência acumulada relativa</th></tr>`);

        const total = bins.reduce((s, b) => s + b.freq, 0);
        const maxF = Math.max(0, ...bins.map(b => b.freq));
        const modalIdx = new Set(bins.map((b, i) => (b.freq === maxF ? i : -1)).filter(i => i >= 0));

        let acc = 0,
          accRel = 0;
        bins.forEach((b, i) => {
          acc += b.freq;
          const fr = total ? b.freq / total : 0;
          accRel += fr;
          const isModal = modalIdx.has(i);
          rows.push(`<tr class="${isModal ? "tr-modal" : ""}">
      <td>${i + 1}${isModal ? `<span class="badge-modal">modal</span>` : ""}</td>
      <td>${intervalLabel(b)}</td>
      <td>${b.freq}</td>
      <td>${(fr * 100).toFixed(2)}%</td>
      <td>${acc}</td>
      <td>${(accRel * 100).toFixed(2)}%</td>
    </tr>`);
        });
        tbl.innerHTML = rows.join("");
      }

      function renderChart(bins) {
        const ctx = el("histCanvas");
        const labels = bins.map(intervalLabel);
        const data = bins.map(b => b.freq);

        // identifica classe(s) modal(is)
        const maxF = Math.max(0, ...data);
        const modalIdx = new Set(data.map((f, i) => (f === maxF ? i : -1)).filter(i => i >= 0));

        // cores: padrão + destaque para modais
        const baseBg = "rgba(122,162,255,0.35)";
        const baseBorder = "rgba(122,162,255,0.85)";
        const modalBg = "rgba(251,191,36,0.55)"; // amarelo
        const modalBorder = "rgba(251,191,36,0.95)";

        const bg = labels.map((_, i) => (modalIdx.has(i) ? modalBg : baseBg));
        const border = labels.map((_, i) => (modalIdx.has(i) ? modalBorder : baseBorder));

        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: "bar",
          data: {
            labels,
            datasets: [
              {
                label: "Frequência",
                data,
                backgroundColor: bg,
                borderColor: border,
                borderWidth: 1.5,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              tooltip: { callbacks: { label: c => `freq: ${c.formattedValue}` } },
            },
            scales: {
              x: { grid: { color: "rgba(122,162,255,0.15)" }, ticks: { color: "#dbe4ff", maxRotation: 0, autoSkip: true } },
              y: { grid: { color: "rgba(122,162,255,0.15)" }, ticks: { color: "#dbe4ff" } },
            },
          },
        });
      }

      function downloadCsvSummary(sorted, bins, s) {
        const lines = [];
        lines.push("Resumo");
        lines.push(`n;${s.n}`);
        lines.push(`min;${s.min}`);
        lines.push(`max;${s.max}`);
        lines.push(`amplitude;${s.range}`);
        lines.push(`media;${s.m}`);
        lines.push(`mediana;${s.med}`);
        lines.push(`moda(s);${(s.md || []).join(" | ")}`);
        lines.push(`variancia_pop;${s.varp}`);
        lines.push(`desvio_pop;${s.stdp}`);
        lines.push(`variancia_amostral;${s.vars}`);
        lines.push(`desvio_amostral;${s.stds}`);
        lines.push(`cv_percent;${s.cv}`);
        lines.push("");
        lines.push("Dados ordenados");
        lines.push(sorted.join(";"));
        lines.push("");
        lines.push("Frequencias");
        lines.push("classe;intervalo;freq;freq_rel;freq_acum;freq_acum_rel");
        let acc = 0;
        const total = bins.reduce((z, b) => z + b.freq, 0);
        bins.forEach((b, i) => {
          acc += b.freq;
          const fr = total ? b.freq / total : 0;
          const accRel = total ? acc / total : 0;
          const label = b.label ? b.label : `[${b.from} - ${b.to})`;
          lines.push(`${i + 1};${label};${b.freq};${(fr * 100).toFixed(2)}%;${acc};${(accRel * 100).toFixed(2)}%`);
        });

        const blob = new Blob([lines.join("\n")], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "estatistica-resumo.csv";
        a.click();
        URL.revokeObjectURL(url);
      }

      // ——— Events ———
      document.getElementById("btnCalc").addEventListener("click", () => {
        const decimalMode = decimalSel.value;
        const data = parseNumbers(input.value, decimalMode);
        if (!data.length) {
          alert("Não encontrei números válidos. Verifique o formato.");
          return;
        }
        render(data);
      });

      document.getElementById("btnExample").addEventListener("click", () => {
        input.value = "18,20,19,22,21,20,20,19,18,22,19,21,22,20,23,19,18,21,21,20";
      });
    </script>
  </body>
</html>
